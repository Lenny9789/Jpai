import{b as x}from"./runtime-dom.esm-bundler-65ecdaea.js";import{C as et,D as r,l as st,m as ot,E as o,R as t,G as N,F as E,X as $,Y as n,c as H,w as D,Z as at,_ as nt,o as s,W as _,V as v}from"./index-3dcc8fbd.js";import"./index-6db50d8f.js";/* empty css              */import{N as dt}from"./index-0b36e68f.js";import{_ as j,a as q,b as G}from"./ol3-83447a1c.js";import{r as it}from"./index-ec993ea9.js";import rt from"./SellerOrder-77e15538.js";import{a as P}from"./axios-213479dd.js";import{u as lt}from"./composition_mqtt-af1e43a1.js";import{a as V}from"./common-a47fff3e.js";import{g as ct,a as _t}from"./storage-a45bd5c0.js";import{L as pt}from"./index-30732979.js";import{O as ut,P as vt}from"./mount-component-74e25e35.js";import{s as W}from"./function-call-1b368c68.js";import{_ as mt}from"./_plugin-vue_export-helper-c27b6911.js";import"./_commonjsHelpers-edff4021.js";import"./use-placeholder-ddc70116.js";import"./index-4ccc55cb.js";import"./on-popup-reopen-bcee1d9f.js";import"./constant-77ae5ca0.js";import"./index-210a2739.js";import"./index-560f4955.js";import"./android_api-ee1231ec.js";import"./okl-b455b91c.js";import"./index-0f6eb419.js";import"./Dialog-ab618176.js";import"./index-a7ca7fba.js";import"./use-route-fa97d2d0.js";const c=g=>(at("data-v-dff1d3bd"),g=g(),nt(),g),ht={class:"sell_box"},gt=c(()=>t("div",{class:"spane"},null,-1)),yt=c(()=>t("div",{class:"list_title"}," 在售订单: ",-1)),ft={key:0,class:"List_box"},St=["onClick"],wt={class:"List_top"},Ot=["onClick"],kt={class:"List_main"},Lt={key:0,class:"type1"},It=c(()=>t("span",{class:"dot_Load"},null,-1)),Ut={key:1,class:"type2"},Ct={key:2,class:"type3"},Nt={key:3,class:"type4"},Pt={class:"paymethods"},Rt=c(()=>t("div",null," 收款方式： ",-1)),Mt={class:"pay_imgs"},Tt={key:0,src:j},bt={key:1,src:q},At={key:2,src:G},xt={class:"List_butn"},Et={class:"time"},$t=c(()=>t("div",null,"匹配时间：",-1)),Ht={class:"time_word"},Dt=c(()=>t("div",{class:"list_title"}," 正在交易订单: ",-1)),Vt={key:1,class:"List_box"},Wt=["onClick"],jt={class:"List_top"},qt=["onClick"],Gt={class:"List_main"},Bt={key:0,class:"type1"},Ft=c(()=>t("span",{class:"dot_Load"},null,-1)),Yt={key:1,class:"type2"},zt={key:2,class:"type3"},Kt={key:3,class:"type4"},Qt={class:"paymethods"},Jt=c(()=>t("div",null," 收款方式： ",-1)),Xt={class:"pay_imgs"},Zt={key:0,src:j},te={key:1,src:q},ee={key:2,src:G},se={class:"List_butn"},oe={class:"time"},ae=c(()=>t("div",null,"匹配时间：",-1)),ne={class:"time_word"},de={class:"loading"},ie=et({__name:"SellList",setup(g){ct();const y=_t(),{startMqtt:B,sendMessage:F}=lt(),R=r(!0),p=r(!1);r();const f=r(),S=r(),O=r(0),m=r(0),h=r(0),k=r();let L;const I=r("");r("");const Y=r(null),w=r();st(async()=>{z(),await u(),J()}),ot(()=>{T()});const z=()=>{console.log(y),B(y,(d,i)=>{console.log(i);const a=JSON.parse(i.toString());console.log(a),a.Stage==0?(V({message:`${a.userId}查看了你的订单`}),f.value.map(l=>{l.OrderId==a.OrderId&&l.ckNum++}),S.value.map(l=>{l.OrderId==a.OrderId&&l.ckNum++})):a.Stage==1?(p.value=!0,I.value=a.OrderId,w.value=a.Stage,u()):(a.Stage==2||a.Stage==3)&&(w.value=a.Stage,u())})},K=d=>{console.log(d),d.type=="closePop"?p.value=!1:d.type=="update"?u():F(d.buyerId,JSON.stringify(d.msg))},u=async()=>{f.value=await M(1),S.value=await M(3),R.value=!1},M=async d=>{let i;return await P.post("http://www.myjpai.com:10066/api/Order/GetUserOrderInfo",{userId:y,order_state:d,page:1,pageSize:10}).then(a=>{a.data.status==200&&(a.data.data.map(async l=>{l.Stage=await Q(l.OrderId),l.ckNum=0}),i=a.data.data)}),i},Q=async d=>{let i;return await P.post("http://www.myjpai.com:10066/api/Order/GetNewestOrederSchedule",{OrderId:d}).then(a=>{a.data.status==200&&(i=a.data.data.Stage)}),i},J=()=>{L=setInterval(()=>{h.value++,h.value==60&&(h.value=0,m.value++),m.value==60&&(m.value=0,O.value++),k.value=`${O.value}:${m.value}:${h.value}`},1e3)},T=()=>{clearInterval(L),L=null,h.value=0,m.value=0,O.value=0},b=d=>{W({message:"是否确认取消订单？"}).then(async()=>[await P.post("http://www.myjpai.com:10066/api/Order/CancelOrederInfo",{OrderId:d,UserId:y}).then(i=>{i.data.status==200&&(u(),V({message:"取消成功"}))})]).catch(()=>[])},A=d=>{console.log("触发"),I.value=d,p.value=!0},X=()=>{W({title:"退出匹配",message:"该操作将立即断联您的匹配，是否依然需要退出"}).then(()=>{T(),it.push("shop")}).catch(()=>{})};return(d,i)=>{const a=dt,l=pt,Z=ut,tt=vt;return s(),o("div",ht,[t("div",null,[gt,N(a,{title:"挂售列表","left-arrow":"",onClickLeft:X,"z-index":"999"})]),yt,f.value?(s(),o("div",ft,[(s(!0),o(E,null,$(f.value,(e,U)=>(s(),o("div",{class:"List_cord",key:U,onClick:C=>A(e.OrderId)},[t("div",wt,[t("div",null,[_("挂售金额：￥"),t("span",null,v(e.Sum),1)]),e.Stage==0?(s(),o("div",{key:0,onClick:x(C=>b(e.OrderId),["stop"])},"取消订单",8,Ot)):n("",!0)]),t("div",kt,[e.Stage==0?(s(),o("div",Lt,[_("正在匹配买家"),It])):n("",!0),e.Stage==1?(s(),o("div",Ut,"买家预下单")):n("",!0),e.Stage==2?(s(),o("div",Ct,"买家付款")):n("",!0),e.Stage==3?(s(),o("div",Nt,"卖家确认")):n("",!0)]),t("div",Pt,[Rt,t("div",Mt,[e.PayPal==1?(s(),o("img",Tt)):n("",!0),e.WeChat==1?(s(),o("img",bt)):n("",!0),e.UnionPay==1?(s(),o("img",At)):n("",!0)])]),t("div",xt,[t("div",Et,[$t,t("div",Ht,v(k.value),1)]),t("div",null,[_("当前已被"),t("span",null,v(e.ckNum),1),_("人查看")])])],8,St))),128))])):n("",!0),Dt,S.value?(s(),o("div",Vt,[(s(!0),o(E,null,$(S.value,(e,U)=>(s(),o("div",{class:"List_cord",key:U,onClick:C=>A(e.OrderId)},[t("div",jt,[t("div",null,[_("挂售金额：￥"),t("span",null,v(e.Sum),1)]),e.Stage==0?(s(),o("div",{key:0,onClick:x(C=>b(e.OrderId),["stop"])},"取消订单",8,qt)):n("",!0)]),t("div",Gt,[e.Stage==0?(s(),o("div",Bt,[_("正在匹配买家"),Ft])):n("",!0),e.Stage==1?(s(),o("div",Yt,"买家预下单")):n("",!0),e.Stage==2?(s(),o("div",zt,"买家付款")):n("",!0),e.Stage==3?(s(),o("div",Kt,"卖家确认")):n("",!0)]),t("div",Qt,[Jt,t("div",Xt,[e.PayPal==1?(s(),o("img",Zt)):n("",!0),e.WeChat==1?(s(),o("img",te)):n("",!0),e.UnionPay==1?(s(),o("img",ee)):n("",!0)])]),t("div",se,[t("div",oe,[ae,t("div",ne,v(k.value),1)]),t("div",null,[_("当前已被"),t("span",null,v(e.ckNum),1),_("人查看")])])],8,Wt))),128))])):(s(),H(Z,{key:2,show:R.value,"z-index":"99"},{default:D(()=>[t("div",de,[N(l,{color:"#fff"})])]),_:1},8,["show"])),N(tt,{show:p.value,"onUpdate:show":i[0]||(i[0]=e=>p.value=e),position:"right",style:{width:"95%",height:"100%"}},{default:D(()=>[p.value?(s(),H(rt,{key:0,ref_key:"orderCom",ref:Y,OrderId:I.value,Stage:w.value,onSendMsgToUser:K},null,8,["OrderId","Stage"])):n("",!0)]),_:1},8,["show"])])}}});const $e=mt(ie,[["__scopeId","data-v-dff1d3bd"]]);export{$e as default};
