import{C as J,O as D,D as c,ad as Z,l as tt,m as et,E as r,R as t,G as n,V as u,w as S,Y as h,U as H,Z as st,_ as at,W as I,o as m}from"./index-3dcc8fbd.js";import{C as ot}from"./index-210a2739.js";import{S as it,a as dt}from"./index-560f4955.js";import"./index-ec993ea9.js";import{a as w}from"./axios-213479dd.js";import{a as N}from"./android_api-ee1231ec.js";import{a as T}from"./common-a47fff3e.js";import{m as M}from"./okl-b455b91c.js";import{s as ct}from"./function-call-1b368c68.js";import"./index-0f6eb419.js";import{I as nt}from"./index-4ccc55cb.js";import{_ as _t}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-30732979.js";import"./constant-77ae5ca0.js";import"./runtime-dom.esm-bundler-65ecdaea.js";/* empty css              */import"./index-6db50d8f.js";import"./_commonjsHelpers-edff4021.js";import"./mount-component-74e25e35.js";import"./on-popup-reopen-bcee1d9f.js";import"./Dialog-ab618176.js";import"./index-a7ca7fba.js";import"./use-route-fa97d2d0.js";import"./use-placeholder-ddc70116.js";const o=g=>(st("data-v-e4042591"),g=g(),at(),g),lt={class:"ll"},rt={class:"order_top"},ut={class:"top_item item1"},mt=o(()=>t("div",{class:"top_item item2"},"订单信息",-1)),pt={class:"top_item item3"},vt=o(()=>t("div",{class:"dispute_text"},"交易纠纷",-1)),ht={class:"order_information"},ft={class:"information1"},wt={class:"information2"},It={class:"information3"},gt={class:"information4"},Ot={class:"order_schedule"},St=o(()=>t("div",{class:"schedule_top"},[t("div",{class:"schedule_top_text"},"交易进度"),t("div",{class:"schedule_top_btn"})],-1)),Ut={class:"schedule"},yt={key:0,class:"stage_box"},Lt=o(()=>t("div",{class:"stage_cord"},[t("div",{class:"guide_box"},[t("div",{class:"guide_item"},[I(" 1.等待买家"),t("span",{class:"dot_Load"})])])],-1)),Rt=[Lt],Pt={key:1,class:"stage_box"},Nt={class:"stage_cord"},Tt={class:"stage_top"},bt=o(()=>t("div",{class:"title_time"},"二阶段倒计时:",-1)),Ct={class:"time"},At=o(()=>t("div",{class:"guide_box"},[t("div",{class:"guide_item"},[I(" 1.等待买家付款"),t("span",{class:"dot_Load"})])],-1)),xt={key:2,class:"stage_box"},Et={class:"stage_cord"},kt={class:"stage_top"},Dt=o(()=>t("div",{class:"title_time"},"三阶段倒计时:",-1)),Ht={class:"time"},Mt={class:"guide_box"},Yt=o(()=>t("div",{class:"guide_item"}," 1.查询是否收到货款 ",-1)),Ft=["src"],Vt=o(()=>t("span",null,"即将进入系统转账",-1)),jt={class:"no_btn"},Gt=o(()=>t("span",null,"即将进入仲裁阶段",-1)),Xt={key:3,class:"stage_box"},$t=o(()=>t("div",{class:"stage_cord"},[t("div",{class:"sccess_text"},"恭喜您交易完成！")],-1)),Wt=[$t],qt={key:4,class:"buyer_information"},Kt=o(()=>t("div",{class:"buyer_information_text"},[t("span",null,"买家信息")],-1)),Qt={class:"buyer_information_item"},Bt={class:"user_img"},zt=["src"],Jt={class:"user_info"},Zt={class:"user_info_item"},te={class:"user_info_item"},ee=o(()=>t("div",{class:"user_info_item"},"名字：啦啦啦",-1)),se=o(()=>t("div",{class:"user_info_item"},"历史交易数：15",-1)),ae={key:5,class:"buyer_information Seller"},oe=o(()=>t("div",{class:"buyer_information_text"},[t("span",null,"卖家信息")],-1)),ie={class:"buyer_information_item"},de={class:"user_img"},ce=["src"],ne={class:"user_info"},_e={class:"user_info_item"},le={class:"user_info_item"},re=o(()=>t("div",{class:"user_info_item"},"名字：啦啦啦",-1)),ue=o(()=>t("div",{class:"user_info_item"},"历史交易数：10",-1)),me=J({__name:"SellerOrder",props:{OrderId:{type:String,default:""},Stage:{type:Number,default:-1}},emits:["sendMsgToUser"],setup(g,{expose:Y,emit:F}){const _=g;D(()=>_.OrderId,async(e,s)=>{e&&(await A(),await O(),a.value.PurchaserId&&a.value.SellerId&&await y())}),D(()=>_.Stage,async(e,s)=>{e&&(await O(),a.value.PurchaserId&&a.value.SellerId&&await y())});const U=c(),a=c(),R=c(),p=c(),v=c(),i=c(-1),l=Z({startX:0,startY:0,endX:0,endY:0}),V=c(3e5),P=c(0);c(),tt(async()=>{await A(),await O(),a.value.PurchaserId&&a.value.SellerId&&await y()}),et(()=>{});const j=e=>{l.startX=e.changedTouches[0].clientX,l.startY=e.changedTouches[0].clientY},G=e=>{l.endX=e.changedTouches[0].clientX,l.endY=e.changedTouches[0].clientY;let s=Number(l.startX)-Number(l.endX),d=Number(l.startY)-Number(l.endY);s<=-100&&d>=-50&&d<=50&&f("closePop")},b=()=>{const e=new Date(a.value.OperationTime).getTime(),s=Date.now();let d=Number(s)-Number(e);P.value=V.value-d},C=()=>{T({message:"订单已超时，即将返回上一页"}),f("closePop"),f("update")},f=e=>{let s={Stage:4};F("sendMsgToUser",{type:e,buyerId:a.value.PurchaserId,msg:s})},A=async()=>{await w.post("http://www.myjpai.com:10066/api/Order/GetOrederInfo",{OrderId:_.OrderId}).then(e=>{e.data.status==200&&(U.value=e.data.data)})},O=async()=>{await w.post("http://www.myjpai.com:10066/api/Order/GetNewestOrederSchedule",{OrderId:_.OrderId}).then(e=>{e.data.status==200&&(a.value=e.data.data,a.value.Stage==1?(i.value=1,b()):a.value.Stage==2&&a.value.ProcedureInfo==2?(i.value=2,b(),x()):a.value.Stage>=3&&(i.value=3))})},x=async()=>{await w.post("http://www.myjpai.com:10066/api/Order/GetOrderCertifcate",{OrderId:_.OrderId}).then(e=>{e.data.status==200&&N.call("getMinIOConfit",null,s=>{s.status==200&&(R.value="http://"+s.data.end_point+"/"+e.data.data.CertificateUrl)})})},X=()=>{ct({message:"是否确认收款"}).then(()=>{E(0,"确认收款"),i.value=3}).catch(()=>{})},E=async(e,s)=>{await w.post("http://www.myjpai.com:10066/api/Order/AddOrederSchedule",{OrderId:_.OrderId,Stage:3,ProcedureInfo:1,OperationState:e,Info:s,PurchaserId:a.value.PurchaserId,SellerId:a.value.SellerId}).then(async d=>{d.data.status==200&&(await f("msg"),await W())})},$=async()=>{await w.post("http://www.myjpai.com:10066/api/Order/AddOrederSchedule",{OrderId:_.OrderId,Stage:4,ProcedureInfo:1,OperationState:0,Info:"已完成订单",PurchaserId:a.value.PurchaserId,SellerId:a.value.SellerId}).then(async e=>{e.data.status==200&&(await O(),await f("update"))})},W=()=>{w.post("http://www.myjpai.com:10066/api/Order/CompleteOrederInfo",{OrderId:_.OrderId,BuyerId:a.value.PurchaserId,SellerId:a.value.SellerId}).then(async e=>{e.data.status==200&&await $()})},q=()=>{f("closePop")},K=()=>{},Q=e=>{N.call("getUserInfo",JSON.stringify({data:e}),s=>{s.status==200?(console.log(s.data),p.value=s.data):T({message:s.msg})})},B=e=>{N.call("getUserInfo",JSON.stringify({data:e}),s=>{s.status==200?(console.log(s.data),v.value=s.data):T({message:s.msg})})},y=async()=>{await Q(a.value.PurchaserId),await B(a.value.SellerId)};return Y({getOrderStage:O,getOrderCert:x,getAllUserInfo:y}),(e,s)=>{const d=nt,L=it,z=dt,k=ot;return m(),r("div",{class:"order_box",onTouchstart:j,onTouchend:G},[t("div",lt,[t("div",rt,[t("div",ut,[n(d,{name:"arrow-left",size:"30",color:"white",onClick:q})]),mt,t("div",pt,[t("div",{class:"dispute",onClick:K},[n(d,{name:"todo-list-o",size:"30",color:"white"}),vt])])]),t("div",ht,[t("div",ft,[t("div",null,u(i.value==3?"已完成":"进行中"),1)]),t("div",wt,[t("span",null,u(U.value.UserId),1)]),t("div",It,u(Number(U.value.ActualSum)),1),t("div",gt,[t("div",null,"订单号："+u(U.value.OrderId),1)])]),t("div",Ot,[St,t("div",Ut,[n(z,{active:i.value,"active-icon":"success","active-color":"#07c160"},{default:S(()=>[n(L,null,{default:S(()=>[I("买家下单")]),_:1}),n(L,null,{default:S(()=>[I("买家付款")]),_:1}),n(L,null,{default:S(()=>[I("卖家确认")]),_:1}),n(L,null,{default:S(()=>[I("交易完成")]),_:1})]),_:1},8,["active"])])]),i.value==-1?(m(),r("div",yt,Rt)):h("",!0),a.value.ProcedureInfo==1&&i.value==1?(m(),r("div",Pt,[t("div",Nt,[t("div",Tt,[bt,t("div",Ct,[n(k,{time:P.value,onFinish:C},null,8,["time"])])]),At])])):h("",!0),a.value.ProcedureInfo==2&&i.value==2?(m(),r("div",xt,[t("div",Et,[t("div",kt,[Dt,t("div",Ht,[n(k,{time:P.value,onFinish:C},null,8,["time"])])]),t("div",Mt,[Yt,R.value?(m(),r("img",{key:0,src:R.value},null,8,Ft)):h("",!0),t("div",{class:"yes_btn"},[t("button",{onClick:X},"是"),Vt]),t("div",jt,[t("button",{onClick:s[0]||(s[0]=pe=>E(1,"卖家没收到款"))},"否"),Gt])])])])):h("",!0),i.value==3?(m(),r("div",Xt,Wt)):h("",!0),i.value>-1?(m(),r("div",qt,[Kt,t("div",Qt,[t("div",Bt,[t("img",{src:p.value.FaceURL?p.value.FaceURL:H(M),alt:""},null,8,zt)]),t("div",Jt,[t("div",Zt,"昵称："+u(p.value.NickName?p.value.NickName:`用户${p.value.Id}`),1),t("div",te,"账号："+u(p.value.Id),1),ee,se])])])):h("",!0),i.value>-1?(m(),r("div",ae,[oe,t("div",ie,[t("div",de,[t("img",{src:v.value.FaceURL?v.value.FaceURL:H(M),alt:""},null,8,ce)]),t("div",ne,[t("div",_e,"昵称："+u(v.value.NickName?v.value.NickName:`用户${v.value.Id}`),1),t("div",le,"账号："+u(v.value.Id),1),re,ue])])])):h("",!0)])],32)}}});const Ye=_t(me,[["__scopeId","data-v-e4042591"]]);export{Ye as default};
