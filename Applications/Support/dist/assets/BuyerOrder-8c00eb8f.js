import{C as _e,am as ue,D as s,ad as G,O as me,l as pe,E as u,R as e,G as r,Y as c,V as m,U,w as _,Z as he,_ as ve,W as p,o as d,c as k}from"./index-3dcc8fbd.js";/* empty css              *//* empty css              *//* empty css              */import"./index-6db50d8f.js";import{R as ge,a as Ie}from"./index-f4e05e24.js";import"./index-6f49421e.js";import{C as ye}from"./index-210a2739.js";import{S as we,a as fe}from"./index-560f4955.js";import{r as R}from"./index-ec993ea9.js";import{a as f}from"./axios-213479dd.js";import{u as Se}from"./composition_mqtt-af1e43a1.js";import{a as L}from"./android_api-ee1231ec.js";import{a as O}from"./common-a47fff3e.js";import{g as Ue,a as Oe}from"./storage-a45bd5c0.js";import{m as j}from"./okl-b455b91c.js";import{I as Pe}from"./index-4ccc55cb.js";import{D as Re}from"./index-0f6eb419.js";import{B as Le}from"./index-a7ca7fba.js";import{_ as Ne}from"./_plugin-vue_export-helper-c27b6911.js";import"./_commonjsHelpers-edff4021.js";import"./index-30732979.js";import"./constant-77ae5ca0.js";import"./runtime-dom.esm-bundler-65ecdaea.js";import"./mount-component-74e25e35.js";import"./on-popup-reopen-bcee1d9f.js";import"./Dialog-ab618176.js";import"./use-placeholder-ddc70116.js";import"./use-route-fa97d2d0.js";const i=P=>(he("data-v-74727d2d"),P=P(),ve(),P),Ce={class:"order_box"},be={class:"ll"},Ae={key:0,class:"order_top"},Te={class:"top_item item1"},ke=i(()=>e("div",{class:"top_item item2"},"订单信息",-1)),Ee={class:"top_item item3"},qe=i(()=>e("div",{class:"dispute_text"},"交易纠纷",-1)),Me={class:"order_information"},De={class:"information1"},He={class:"information2"},xe={class:"information3"},We={class:"information4"},Be={class:"order_schedule"},Ge=i(()=>e("div",{class:"schedule_top"},[e("div",{class:"schedule_top_text"},"交易进度"),e("div",{class:"schedule_top_btn"})],-1)),je={class:"schedule"},Ve={key:1,class:"stage_box"},Fe={class:"stage_cord"},$e={class:"stage_top"},Ye=i(()=>e("div",{class:"title_time"},"二阶段倒计时:",-1)),Ke={class:"time"},Qe={class:"guide_box"},Je={class:"guide_item"},ze=i(()=>e("span",null,"1.选择卖家指定收款方式",-1)),Ze={class:"guide_item"},Xe=i(()=>e("span",null,"2.买家完成付款",-1)),et={key:2,class:"stage_box"},tt={class:"stage_cord"},ot={class:"stage_top"},at=i(()=>e("div",{class:"title_time"},"三阶段倒计时:",-1)),st={class:"time"},dt=i(()=>e("div",{class:"guide_box"},[e("div",{class:"guide_item"},"1.等待卖家查询是否收到货款")],-1)),it={key:3,class:"stage_box"},lt=i(()=>e("div",{class:"stage_cord"},[e("div",{class:"sccess_text"},"恭喜您交易完成！")],-1)),nt=[lt],rt={class:"buyer_information"},ct=i(()=>e("div",{class:"buyer_information_text"},[e("span",null,"买家信息")],-1)),_t={class:"buyer_information_item"},ut={class:"user_img"},mt=["src"],pt={class:"user_info"},ht={class:"user_info_item"},vt={class:"user_info_item"},gt=i(()=>e("div",{class:"user_info_item"},"历史交易数：15",-1)),It=i(()=>e("div",{class:"user_info_item"},[p("收款码: "),e("span",{class:"olt"},"收款凭证")],-1)),yt={class:"buyer_information Seller"},wt=i(()=>e("div",{class:"buyer_information_text"},[e("span",null,"卖家信息")],-1)),ft={class:"buyer_information_item"},St={class:"user_img"},Ut=["src"],Ot={class:"user_info"},Pt={class:"user_info_item"},Rt={class:"user_info_item"},Lt=i(()=>e("div",{class:"user_info_item"},[p("收款码: "),e("span",{class:"olt"},"付款凭证")],-1)),Nt={class:"dialog_box"},Ct={class:"dialog_item"},bt=["src"],At=["src"],Tt={key:5,class:"dang_btn"},kt={key:7,class:"wy_list"},Et=_e({__name:"BuyerOrder",props:{OrderId:{type:String,default:""}},setup(P){Ue();const V=Oe(),l=ue(),E=s(!1),F=window.localStorage.getItem("buyingId"),{startMqtt:$,sendMessage:q}=Se();s(!0);const S=s(0),v=s(0),N=s(!1);s(1),s(1);const g=s(1),o=G({PurchaserId:"",SellerId:"",Stage:0,Procedure:0,OrderId:l.query.OrderId,PayPal:0,WeChat:0,UnionPay:0,Sum:0,ActualSum:0,OperationTime:0}),n=G({WeChat_Url:"",PayPal_Url:"",CN:"",name:"",bank:""}),C=s(),M=s(),Y=s(3e5),D=()=>{const t=new Date(o.OperationTime).getTime(),a=Date.now();let h=Number(a)-Number(t);C.value=Y.value-h},K=()=>{clearInterval(M.value),M.value=null},H=()=>{window.localStorage.removeItem("buyingId"),window.localStorage.removeItem("buyingUId"),O({message:"订单已超时，即将返回上一页"}),R.push("/shop")},Q=t=>{console.log("链接"),console.log(t+"111111111"),$(t,(a,h)=>{const w=JSON.parse(h.toString());console.log(w),w.Stage==4&&b()})};me(S,(t,a)=>{t==1?v.value=1:t==2?v.value=2:t==3&&(v.value=3)});const J=()=>{R.push("/shop")},z=()=>{L.call("getAlbumResource",JSON.stringify({bucket_name:"shop",purpose_code:1}),t=>{if(t.status==200){console.log("++++++++++++++++++++++++"),console.log(t.data);let a=t.data.bucket+"/"+t.data.object;f.post("http://www.myjpai.com:10066/api/Order/AddOrderCertifcate",{OrderId:l.query.OrderId?l.query.OrderId:window.localStorage.getItem("buyingId"),CertificateUrl:a}).then(h=>{Z(),O({message:"上传成功"})}).catch(h=>{O({message:"上传失败"})})}})},Z=()=>{let t;S.value==1?t="100":S.value==2?t="101":t="102",f.post("http://www.myjpai.com:10066/api/Order/AddOrederSchedule",{OrderId:l.query.OrderId?l.query.OrderId:window.localStorage.getItem("buyingId"),Stage:2,ProcedureInfo:1,Info:t,PurchaserId:o.PurchaserId,SellerId:o.SellerId,OperationState:0}).then(a=>{if(a.data.status==200){let h={Stage:2};q(o.SellerId,JSON.stringify(h)),X()}}).catch(a=>{})},X=()=>{f.post("http://www.myjpai.com:10066/api/Order/AddOrederSchedule",{OrderId:l.query.OrderId?l.query.OrderId:window.localStorage.getItem("buyingId"),Stage:2,ProcedureInfo:2,Info:"无",PurchaserId:o.PurchaserId,SellerId:o.SellerId,OperationState:0}).then(t=>{let a={Stage:3};q(o.SellerId,JSON.stringify(a)),console.log("2222222222"),console.log("555555555555555555555555555555555555"),console.log(o.SellerId),b()}).catch(t=>{})},ee=()=>{f.post("http://www.myjpai.com:10066/api/AB/GetPayImg",{UserId:o.SellerId}).then(t=>{L.call("getMinIOConfit",null,a=>{a.status==200&&(n.PayPal_Url="http://"+a.data.end_point+"/"+t.data.data.PayPal_Url,n.WeChat_Url="http://"+a.data.end_point+"/"+t.data.data.WeChat_Url,console.log(n.PayPal_Url),console.log(n.WeChat_Url))})}).catch(t=>{})},te=()=>{f.post("http://www.myjpai.com:10066/api/AB/GetListCardNumber",{UserId:o.SellerId}).then(t=>{n.name=t.data.data.NAME,n.bank=t.data.data.Bank,n.CN=t.data.data.CN}).catch(t=>{})},oe=()=>{N.value=!0,ee(),te(),console.log(n)},x=()=>{R.push("/abnormal")},ae=()=>{R.push("/middle")},se=()=>{f.post("http://www.myjpai.com:10066/api/Order/GetOrederInfo",{OrderId:l.query.OrderId?l.query.OrderId:window.localStorage.getItem("buyingId")}).then(t=>{o.PayPal=t.data.data.PayPal,o.WeChat=t.data.data.WeChat,o.UnionPay=t.data.data.UnionPay,o.Sum=Number(t.data.data.Sum),o.ActualSum=Number(t.data.data.ActualSum),console.log("11111111111111111111111"),console.log(o.PayPal),console.log(typeof o.PayPal)}).catch(t=>{console.log("获取订单信息失败")})};s();const b=()=>{f.post("http://www.myjpai.com:10066/api/Order/GetNewestOrederSchedule",{OrderId:l.query.OrderId?l.query.OrderId:window.localStorage.getItem("buyingId")}).then(t=>{o.PurchaserId=t.data.data.PurchaserId,o.SellerId=t.data.data.SellerId,o.Stage=t.data.data.Stage,o.Procedure=t.data.data.ProcedureInfo,o.OperationTime=Date.parse(t.data.data.OperationTime),le(t.data.data.PurchaserId,t.data.data.SellerId),o.Stage==1&&o.Procedure==1&&D(),o.Stage==2&&o.Procedure==1?g.value=1:o.Stage==2&&o.Procedure==2?(g.value=2,D()):o.Stage>=3&&o.Procedure==1&&(g.value=3,K(),window.localStorage.removeItem("buyingId"),window.localStorage.removeItem("buyingUId"),E.value=!0)})},I=s(),y=s(),de=t=>{L.call("getUserInfo",JSON.stringify({data:t}),a=>{a.status===200?(I.value=a.data,console.log(I.value)):O({message:a.msg})})},ie=t=>{L.call("getUserInfo",JSON.stringify({data:t}),a=>{a.status===200?(y.value=a.data,console.log(y.value)):O({message:a.msg})})},le=(t,a)=>{de(a),ie(t)};return pe(()=>{se(),b(),Q(V)}),(t,a)=>{const h=Pe,w=we,ne=fe,W=ye,B=Le,A=ge,re=Ie,ce=Re;return d(),u("div",Ce,[e("div",be,[E.value?(d(),u("div",Ae,[e("div",Te,[r(h,{name:"arrow-left",size:"30",color:"white",onClick:J})]),ke,e("div",Ee,[e("div",{class:"dispute",onClick:ae},[r(h,{name:"todo-list-o",size:"30",color:"white"}),qe])])])):c("",!0),e("div",Me,[e("div",De,[e("div",null,m(g.value==3?"已完成":"进行中"),1)]),e("div",He,[e("span",null,m(o.SellerId),1)]),e("div",xe,"￥"+m(o.ActualSum),1),e("div",We,[e("div",null,"订单号："+m(U(l).query.OrderId?U(l).query.OrderId:U(F)),1)])]),e("div",Be,[Ge,e("div",je,[r(ne,{active:g.value,"active-icon":"success","active-color":"#07c160"},{default:_(()=>[r(w,null,{default:_(()=>[p("买家下单")]),_:1}),r(w,null,{default:_(()=>[p("买家付款")]),_:1}),r(w,null,{default:_(()=>[p("卖家确认")]),_:1}),r(w,null,{default:_(()=>[p("交易完成")]),_:1})]),_:1},8,["active"])])]),g.value==1?(d(),u("div",Ve,[e("div",Fe,[e("div",$e,[Ye,e("div",Ke,[r(W,{time:C.value,onFinish:H},null,8,["time"])])]),e("div",Qe,[e("div",Je,[ze,r(B,{type:"danger",onClick:oe,round:""},{default:_(()=>[p("收款方式")]),_:1})]),e("div",Ze,[Xe,r(B,{type:"danger",onClick:z,round:""},{default:_(()=>[p("上传凭证")]),_:1})])])])])):c("",!0),g.value==2?(d(),u("div",et,[e("div",tt,[e("div",ot,[at,e("div",st,[r(W,{time:C.value,onFinish:H},null,8,["time"])])]),dt])])):c("",!0),g.value==3?(d(),u("div",it,nt)):c("",!0),e("div",rt,[ct,e("div",_t,[e("div",ut,[e("img",{src:y.value.FaceURL?y.value.FaceURL:U(j),alt:""},null,8,mt)]),e("div",pt,[e("div",ht,"昵称："+m(y.value.NickName?y.value.NickName:`用户${y.value.Id}`),1),e("div",vt,"账号："+m(y.value.Id),1),gt,It])])]),e("div",yt,[wt,e("div",ft,[e("div",St,[e("img",{src:I.value.FaceURL?I.value.FaceURL:U(j),alt:""},null,8,Ut)]),e("div",Ot,[e("div",Pt,"昵称："+m(I.value.NickName?I.value.NickName:`用户${I.value.Id}`),1),e("div",Rt,"账号："+m(I.value.Id),1),Lt])])])]),r(ce,{show:N.value,"onUpdate:show":a[1]||(a[1]=T=>N.value=T),title:"选择支付方式","show-cancel-button":"",width:"95%",class:"lp",style:{"overflow-y":"scroll !important"}},{default:_(()=>[e("div",Nt,[e("div",Ct,[r(re,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=T=>S.value=T)},{default:_(()=>[o.WeChat!==0?(d(),k(A,{key:0,name:"1",class:"radio_item"},{default:_(()=>[p("微信")]),_:1})):c("",!0),v.value==1?(d(),u("img",{key:1,src:n.WeChat_Url,alt:""},null,8,bt)):c("",!0),v.value==1?(d(),u("div",{key:2,class:"dang_btn",onClick:x}," 遇到支付问题 ")):c("",!0),o.PayPal!==0?(d(),k(A,{key:3,name:"2",class:"radio_item"},{default:_(()=>[p("支付宝")]),_:1})):c("",!0),v.value==2?(d(),u("img",{key:4,src:n.PayPal_Url,alt:""},null,8,At)):c("",!0),v.value==2?(d(),u("div",Tt,"遇到支付问题")):c("",!0),o.UnionPay!==0?(d(),k(A,{key:6,name:"3",class:"radio_item"},{default:_(()=>[p("网银")]),_:1})):c("",!0),v.value==3?(d(),u("div",kt,[e("div",null,"收款账户："+m(n.CN),1),e("div",null,"收款人："+m(n.name),1),e("div",null,"开户行："+m(n.bank),1)])):c("",!0),v.value==3?(d(),u("div",{key:8,class:"dang_btn",onClick:x}," 遇到支付问题 ")):c("",!0)]),_:1},8,["modelValue"])])])]),_:1},8,["show"])])}}});const _o=Ne(Et,[["__scopeId","data-v-74727d2d"]]);export{_o as default};
