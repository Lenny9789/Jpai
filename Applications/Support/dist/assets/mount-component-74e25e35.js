import{T as _,v as B,c as J}from"./runtime-dom.esm-bundler-65ecdaea.js";import{n as k,t as C,g as L,o as Q,h as ee,p as R,c as N,d as Y,i as te,w as K,m as T,j as oe,I as ne}from"./index-4ccc55cb.js";import{u as $}from"./index-30732979.js";import{T as A,H as ae}from"./constant-77ae5ca0.js";import{a5 as se,a6 as le,D as i,a7 as F,a8 as ce,O as x,C as M,G as h,a2 as g,a1 as X,a9 as j,N as re,n as ie,l as ue,aa as de,ab as ve,ac as fe,F as me,$ as he,ad as ye}from"./index-3dcc8fbd.js";import{P as Ie}from"./on-popup-reopen-bcee1d9f.js";function Oe(e,{args:t=[],done:o,canceled:a}){if(e){const n=e.apply(null,t);se(n)?n.then(s=>{s?o():a&&a()}).catch(le):n?o():a&&a()}else o()}const H={show:Boolean,zIndex:k,overlay:C,duration:k,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:L,transitionAppear:Boolean,closeOnClickOverlay:C},Re=Object.keys(H);function Ce(e,t){return e>t?"horizontal":t>e?"vertical":""}function Pe(){const e=i(0),t=i(0),o=i(0),a=i(0),n=i(0),s=i(0),l=i(""),r=i(!0),P=()=>l.value==="vertical",O=()=>l.value==="horizontal",u=()=>{o.value=0,a.value=0,n.value=0,s.value=0,l.value="",r.value=!0};return{move:d=>{const v=d.touches[0];o.value=(v.clientX<0?0:v.clientX)-e.value,a.value=v.clientY-t.value,n.value=Math.abs(o.value),s.value=Math.abs(a.value);const I=10;(!l.value||n.value<I&&s.value<I)&&(l.value=Ce(n.value,s.value)),r.value&&(n.value>A||s.value>A)&&(r.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:o,deltaY:a,offsetX:n,offsetY:s,direction:l,isVertical:P,isHorizontal:O,isTap:r}}let p=0;const E="van-overflow-hidden";function pe(e,t){const o=Pe(),a="01",n="10",s=u=>{o.move(u);const y=o.deltaY.value>0?n:a,w=ee(u.target,e.value),{scrollHeight:d,offsetHeight:v,scrollTop:I}=w;let f="11";I===0?f=v>=d?"00":"01":I+v>=d&&(f="10"),f!=="11"&&o.isVertical()&&!(parseInt(f,2)&parseInt(y,2))&&R(u,!0)},l=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",s,{passive:!1}),p||document.body.classList.add(E),p++},r=()=>{p&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",s),p--,p||document.body.classList.remove(E))},P=()=>t()&&l(),O=()=>t()&&r();Q(P),F(O),ce(O),x(t,u=>{u?l():r()})}function G(e){const t=i(!1);return x(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const[we,be]=N("overlay"),ke={show:Boolean,zIndex:k,duration:k,className:L,lockScroll:C,lazyRender:C,customStyle:Object};var Se=M({name:we,props:ke,setup(e,{slots:t}){const o=i(),a=G(()=>e.show||!e.lazyRender),n=l=>{e.lockScroll&&R(l,!0)},s=a(()=>{var l;const r=g(te(e.zIndex),e.customStyle);return X(e.duration)&&(r.animationDuration=`${e.duration}s`),j(h("div",{ref:o,style:r,class:[be(),e.className]},[(l=t.default)==null?void 0:l.call(t)]),[[B,e.show]])});return Y("touchmove",n,{target:o}),()=>h(_,{name:"van-fade",appear:!0},{default:s})}});const Te=K(Se),xe=g({},H,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ge,D]=N("popup");var ze=M({name:ge,inheritAttrs:!1,props:xe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:a}){let n,s;const l=i(),r=i(),P=G(()=>e.show||!e.lazyRender),O=re(()=>{const c={zIndex:l.value};if(X(e.duration)){const m=e.position==="center"?"animationDuration":"transitionDuration";c[m]=`${e.duration}s`}return c}),u=()=>{n||(n=!0,l.value=e.zIndex!==void 0?+e.zIndex:oe(),t("open"))},y=()=>{n&&Oe(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},w=c=>{t("clickOverlay",c),e.closeOnClickOverlay&&y()},d=()=>{if(e.overlay)return h(Te,{show:e.show,class:e.overlayClass,zIndex:l.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:w},{default:a["overlay-content"]})},v=c=>{t("clickCloseIcon",c),y()},I=()=>{if(e.closeable)return h(ne,{role:"button",tabindex:0,name:e.closeIcon,class:[D("close-icon",e.closeIconPosition),ae],classPrefix:e.iconPrefix,onClick:v},null)};let f;const V=()=>{f&&clearTimeout(f),f=setTimeout(()=>{t("opened")})},U=()=>t("closed"),Z=c=>t("keydown",c),W=P(()=>{var c;const{round:m,position:b,safeAreaInsetTop:S,safeAreaInsetBottom:q}=e;return j(h("div",he({ref:r,style:O.value,role:"dialog",tabindex:0,class:[D({round:m,[b]:b}),{"van-safe-area-top":S,"van-safe-area-bottom":q}],onKeydown:Z},o),[(c=a.default)==null?void 0:c.call(a),I()]),[[B,e.show]])}),z=()=>{const{position:c,transition:m,transitionAppear:b}=e,S=c==="center"?"van-fade":`van-popup-slide-${c}`;return h(_,{name:m||S,appear:b,onAfterEnter:V,onAfterLeave:U},{default:W})};return x(()=>e.show,c=>{c&&!n&&(u(),o.tabindex===0&&ie(()=>{var m;(m=r.value)==null||m.focus()})),!c&&n&&(n=!1,t("close"))}),$({popupRef:r}),pe(r,()=>e.show&&e.lockScroll),Y("popstate",()=>{e.closeOnPopstate&&(y(),s=!1)}),ue(()=>{e.show&&u()}),de(()=>{s&&(t("update:show",!0),s=!1)}),F(()=>{e.show&&e.teleport&&(y(),s=!0)}),ve(Ie,()=>e.show),()=>e.teleport?h(fe,{to:e.teleport},{default:()=>[d(),z()]}):h(me,null,[d(),z()])}});const Ne=K(ze);function Ye(){const e=ye({show:!1}),t=n=>{e.show=n},o=n=>{g(e,n,{transitionAppear:!0}),t(!0)},a=()=>t(!1);return $({open:o,close:a,toggle:t}),{open:o,close:a,state:e,toggle:t}}function Ke(e){const t=J(e),o=document.createElement("div");return document.body.appendChild(o),{instance:t.mount(o),unmount(){t.unmount(),document.body.removeChild(o)}}}export{Te as O,Ne as P,Ye as a,Re as b,Oe as c,Ke as m,H as p,Pe as u};
