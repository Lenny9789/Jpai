import{C as z,D as o,am as Z,ad as X,l as ee,a8 as te,E as p,R as e,G as C,V as v,U as oe,Y as h,c as ae,w as se,Z as re,_ as ne,o as u,W as le}from"./index-3dcc8fbd.js";/* empty css              */import{C as ie}from"./index-210a2739.js";import{R as ce}from"./index-56bf55ac.js";import{N as ue}from"./index-0b36e68f.js";import{_ as de,a as me,b as _e}from"./ol3-83447a1c.js";import{r as g}from"./index-ec993ea9.js";import{a as N}from"./axios-213479dd.js";import{u as pe}from"./composition_mqtt-af1e43a1.js";import{a as ve}from"./storage-a45bd5c0.js";import{L as he}from"./index-30732979.js";import{s as T}from"./function-call-1b368c68.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-4ccc55cb.js";import"./use-refs-a75f9fe4.js";import"./mount-component-74e25e35.js";import"./runtime-dom.esm-bundler-65ecdaea.js";import"./constant-77ae5ca0.js";import"./on-popup-reopen-bcee1d9f.js";import"./use-placeholder-ddc70116.js";import"./_commonjsHelpers-edff4021.js";import"./Dialog-ab618176.js";import"./index-a7ca7fba.js";import"./use-route-fa97d2d0.js";const L=f=>(re("data-v-45cab869"),f=f(),ne(),f),fe={class:"mate_box"},ye=L(()=>e("div",{class:"spane"},null,-1)),we={class:"mate_top"},Ie={class:"title_num"},Se={class:"mate_mainbox"},Oe={class:"mate_cord"},be={key:0},Ue={class:"pay_type_box"},Pe={class:"pay_type"},Ce={key:0,src:de,alt:"",class:"checked_img"},Ne={key:1,src:me,alt:"",class:"checked_img"},Te={key:2,src:_e,alt:"",class:"checked_img"},Le={class:"userList"},Re=L(()=>e("div",{class:"user_img"},null,-1)),De={class:"userid"},xe={class:"userscore"},Me={class:"countdown_box"},Ae=L(()=>e("div",null,"考虑倒计时剩余:",-1)),ke={class:"Buyer_box"},qe={class:"Buyer_Cord"},Ve={class:"Buyer_Cord"},Be={class:"loading_box"},Ee={key:1,class:"btn_box"},He=z({__name:"mate",setup(f){const n=ve();o(3);const d=Z(),m=o(!1),R=o(),I=o();let D=o(0);const l=o(),x=o(),M=o(),A=o(),_=o(),W=o(15*1e3),S=o(),y=o(null),k=o(0),q=o(0),V=o(0),O=o(""),{startMqtt:j,sendMessage:b}=pe(),i=X({clientId:n,type:"text",Data:{Sum:Number(d.query.Sum),WeChat:Number(d.query.PayPal),PayPal:Number(d.query.WeChat),UnionPay:Number(d.query.UnionPay),Credit:Number(d.query.Credit),NumberOfTrades:Number(d.query.NumberOfTrades)},Time:1693879489});o();const $=()=>{T({title:"退出匹配",message:"该操作将立即断联您的匹配，是否依然需要退出"}).then(()=>{g.push("/shop")}).catch(()=>{})},F=()=>{const s="go_service";let r={clientId:n,type:"verify",Data:{OrderId:l.value},time:Date.now()};const a=JSON.stringify(r);console.log(a),b(s,a)},U=()=>{D.value++,m.value=!0;let s={clientId:n,type:"text",Data:{Sum:i.Data.Sum,WeChat:i.Data.WeChat,PayPal:i.Data.PayPal,UnionPay:i.Data.UnionPay,Credit:i.Data.Credit,NumberOfTrades:i.Data.NumberOfTrades},Time:Date.now()};console.log(s);const r="go_service",a=JSON.stringify(s);console.log(a),b(r,a)};let B;const G=()=>{setInterval(()=>{B++},1e3),B==10&&console.log("赞无商品")},P=(s,r,a,t)=>{b(s,JSON.stringify({userId:t,Stage:a,OrderId:r}))},J=s=>{console.log(s),j(s,(r,a)=>{G();const t=JSON.parse(a.toString());console.log(a.toString()),console.log(t),t.type=="verify"?(console.log(S.value),S.value.data.SellStatus==0?(console.log(t),N.post("http://www.myjpai.com:10066/api/Order/AddOrederSchedule",{OrderId:l.value,Stage:1,ProcedureInfo:1,Info:"无",PurchaserId:n,SellerId:_.value,OperationState:0}).then(c=>{c.status==200&&(console.log("123123"),P(_.value,l.value,1,n),window.localStorage.setItem("buyingId",l.value),window.localStorage.setItem("buyingUId",n),g.push({path:"BuyerOrder",query:{OrderId:l.value}}))}).catch(c=>{})):N.post("http://www.myjpai.com:10066/api/Order/SaveOrederActualSum",{OrderId:l.value,ActualSum:i.Data.Sum}).then(c=>{c.status==200&&N.post("http://www.myjpai.com:10066/api/Order/AddOrederSchedule",{OrderId:l.value,Stage:1,ProcedureInfo:1,Info:"无",PurchaserId:n,SellerId:_.value,OperationState:0}).then(w=>{w.status==200&&(P(_.value,l.value,1,n),window.localStorage.setItem("buyingId",l.value),window.localStorage.setItem("buyingUId",n),g.push({path:"BuyerOrder",query:{OrderId:l.value}}))}).catch(w=>{})}).catch(c=>{})):(console.log("接受的抽卡信息"),console.log(t),S.value=t,x.value=t.data.PayPal==1,M.value=t.data.WeChat==1,A.value=t.data.UnionPay==1,I.value=t.data.Credit/100,_.value=t.data.UserId,R.value=t.data.Sum,m.value=!1,l.value=t.data.OrderId,V.value=t.data.numberOfTrades,P(t.data.UserId,t.data.OrderId,0,n))})},Y=()=>{T({message:"该卖家考虑时间已到，是否继续匹配其他卖家"}).then(()=>{console.log("确定"),U()}).catch(()=>{console.log("取消"),g.push("/shop")})},E=()=>{k.value=Date.now(),y.value=window.setInterval(K,1e3)},H=()=>{y.value&&(clearInterval(y.value),y.value=null,O.value="")},K=()=>{q.value=Date.now();const s=q.value-k.value,r=Math.floor(s/1e3),a=Math.floor(r/60),t=Math.floor(a/60);O.value=`${t} 时 ${a%60} 分 ${r%60} 秒`,console.log(s),s>=15*60*1e3&&m.value==!0&&(H(),T({title:"标题",message:"还没有合适的订单？不妨修改下修改项"}).then(()=>{g.push("/Proposition")}).catch(()=>{E()}))};return ee(()=>{J(n),E(),U()}),te(()=>{H()}),(s,r)=>{const a=ue,t=ce,c=ie,w=he;return u(),p("div",fe,[e("div",null,[ye,C(a,{title:"选择卖家","left-text":"","left-arrow":"",onClickLeft:$})]),e("div",we,"计划购入￥"+v(i.Data.Sum),1),e("div",Ie,[e("div",null,"已查看："+v(oe(D))+"人",1),e("div",null,"已匹配: "+v(O.value),1)]),e("div",Se,[e("div",Oe,[m.value?h("",!0):(u(),p("div",be,[e("div",Ue,[e("div",Pe,[x.value?(u(),p("img",Ce)):h("",!0),M.value?(u(),p("img",Ne)):h("",!0),A.value?(u(),p("img",Te)):h("",!0)])]),e("div",Le,[Re,e("div",null,[e("div",De,v(_.value),1),e("div",xe,[C(t,{modelValue:I.value,"onUpdate:modelValue":r[0]||(r[0]=Q=>I.value=Q),size:25,color:"#ffd21e","void-icon":"star","void-color":"#eee"},null,8,["modelValue"])])])]),e("div",Me,[Ae,e("div",null,[C(c,{time:W.value,onFinish:Y},null,8,["time"])])]),e("div",ke,[e("div",qe,[e("span",null,"订单金额：￥"+v(R.value),1)]),e("div",Ve,[e("span",null,"历史交易次数："+v(V.value)+"次",1)])])])),e("div",Be,[m.value?(u(),ae(w,{key:0,size:"24px",vertical:""},{default:se(()=>[le("加载中...")]),_:1})):h("",!0)]),m.value?h("",!0):(u(),p("div",Ee,[e("button",{class:"btn_item",onClick:U}," 换一个 "),e("button",{class:"btn_item2",onClick:F},"邀请交易")]))])])])}}});const mt=ge(He,[["__scopeId","data-v-45cab869"]]);export{mt as default};
