import{c as J,n as F,m as G,a as K,t as O,b as Q,u as W,d as Z,I as X,e as x,p as $,f as ee,w as te}from"./index-4ccc55cb.js";import{u as ae}from"./use-refs-a75f9fe4.js";import{u as oe}from"./mount-component-74e25e35.js";import{C as le,D as se,N as P,G as f}from"./index-3dcc8fbd.js";const[ne,m]=J("rate");function ie(t,n,s,r){return t>=n?{status:"full",value:1}:t+.5>=n&&s&&!r?{status:"half",value:.5}:t+1>=n&&s&&r?{status:"half",value:Math.round((t-n+1)*1e10)/1e10}:{status:"void",value:0}}const re={size:F,icon:G("star"),color:String,count:K(5),gutter:F,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:G("star-o"),allowHalf:Boolean,voidColor:String,touchable:O,iconPrefix:String,modelValue:Q(0),disabledColor:String};var ue=le({name:ne,props:re,emits:["change","update:modelValue"],setup(t,{emit:n}){const s=oe(),[r,S]=ae(),h=se(),T=P(()=>t.readonly||t.disabled),I=P(()=>T.value||!t.touchable),D=P(()=>Array(+t.count).fill("").map((a,e)=>ie(t.modelValue,e+1,t.allowHalf,t.readonly)));let l,u,g=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER;const N=()=>{u=x(h);const a=r.value.map(x);l=[],a.forEach((e,o)=>{g=Math.min(e.top,g),v=Math.max(e.top,v),t.allowHalf?l.push({score:o+.5,left:e.left,top:e.top,height:e.height},{score:o+1,left:e.left+e.width/2,top:e.top,height:e.height}):l.push({score:o+1,left:e.left,top:e.top,height:e.height})})},V=(a,e)=>{for(let o=l.length-1;o>0;o--)if(e>=u.top&&e<=u.bottom){if(a>l[o].left&&e>=l[o].top&&e<=l[o].top+l[o].height)return l[o].score}else{const c=e<u.top?g:v;if(a>l[o].left&&l[o].top===c)return l[o].score}return t.allowHalf?.5:1},C=a=>{T.value||a===t.modelValue||(n("update:modelValue",a),n("change",a))},Y=a=>{I.value||(s.start(a),N())},L=a=>{if(!I.value&&(s.move(a),s.isHorizontal()&&!s.isTap.value)){const{clientX:e,clientY:o}=a.touches[0];$(a),C(V(e,o))}},U=(a,e)=>{const{icon:o,size:c,color:w,count:y,gutter:E,voidIcon:k,disabled:i,voidColor:z,allowHalf:H,iconPrefix:M,disabledColor:_}=t,b=e+1,R=a.status==="full",d=a.status==="void",j=H&&a.value>0&&a.value<1;let B;E&&b!==+y&&(B={paddingRight:ee(E)});const q=A=>{N();let p=H?V(A.clientX,A.clientY):b;t.clearable&&s.isTap.value&&p===t.modelValue&&(p=0),C(p)};return f("div",{key:e,ref:S(e),role:"radio",style:B,class:m("item"),tabindex:i?void 0:0,"aria-setsize":y,"aria-posinset":b,"aria-checked":!d,onClick:q},[f(X,{size:c,name:R?o:k,class:m("icon",{disabled:i,full:R}),color:i?_:R?w:z,classPrefix:M},null),j&&f(X,{size:c,style:{width:a.value+"em"},name:d?k:o,class:m("icon",["half",{disabled:i,full:!d}]),color:i?_:d?z:w,classPrefix:M},null)])};return W(()=>t.modelValue),Z("touchmove",L,{target:h}),()=>f("div",{ref:h,role:"radiogroup",class:m({readonly:t.readonly,disabled:t.disabled}),tabindex:t.disabled?void 0:0,"aria-disabled":t.disabled,"aria-readonly":t.readonly,onTouchstartPassive:Y},[D.value.map(U)])}});const he=te(ue);export{he as R};
